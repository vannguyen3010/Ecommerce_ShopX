@page "/account/dang-nhap"
@inject AccountService AccountService
@rendermode InteractiveServer

<link rel="stylesheet" type="text/css" href="assets/css/style.min.css">

<main class="main login-page">
    <div class="page-content">
        <div class="container">
            <div class="login-popup">
                <div class="tab tab-nav-boxed tab-nav-center tab-nav-underline">
                    <ul class="nav nav-tabs text-uppercase" role="tablist">
                        <li class="nav-item">
                            <a href="" class="nav-link active">Đăng Nhập</a>
                        </li>
                    </ul>
                    <EditForm Model="_loginModel" OnValidSubmit="HandleLogin" class="tab-content" id="form-login" FormName="form-login">
                        <DataAnnotationsValidator />
                        <div class="tab-pane active">
                            <div class="form-group">
                                <label>Email *</label>
                                <InputText @bind-Value="_loginModel.Email" type="text" class="form-control" name="email" />
                                <ValidationMessage For="@(() => _loginModel.Email)" />
                            </div>
                            <div class="form-group mb-0">
                                <label>Mật khẩu *</label>
                                <InputText @bind-Value="_loginModel.Password" type="password" class="form-control" name="password" />
                                <ValidationMessage For="@(() => _loginModel.Password)" />
                            </div>
                            <div class="form-checkbox d-flex align-items-center justify-content-between">
                                <input type="checkbox" class="custom-checkbox" id="remember1" name="remember1" required="">
                                <label for="remember1">Nhớ mật khẩu</label>
                                <a href="#">Quên mật khẩu</a>
                            </div>
                            <button class="btn btn-primary" type="submit">Đăng nhập</button>
                        </div>
                    </EditForm>

                </div>
            </div>
        </div>
    </div>
</main>

@code {
    private LoginDto _loginModel = new LoginDto();
    private string loginError;

    private async Task HandleLogin()
    {
        try
        {
            var result = await AccountService.LoginAsync(_loginModel);
            if (result.IsAuthSuccessful)
            {
                NavigationManager.NavigateTo("/");
            }
            else
            {
                loginError = "Login failed. Please check your credentials.";
            }
        }
        catch (Exception ex)
        {
            loginError = "An error occurred: " + ex.Message;
        }
    }
}
